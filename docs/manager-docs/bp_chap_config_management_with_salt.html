<!doctype html>
<html lang="en">

<!-- head -->
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>Configuration Management with Salt</title>
    <meta name="description" content="This site generates SUSE documentation using jekyll, asciidoc, travis and github.">
    <meta name="author" content="Your name goes here">
    <meta name="copyright" content="Maybe consider a Creative Commons license">

    <!-- Stylesheets -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous">
    <script src="https://use.fontawesome.com/abbdb82656.js"></script>

    <link rel="stylesheet" href="assets/css/custom.css">
    <link rel="stylesheet" href="assets/css/coderay.css">
    <link rel="stylesheet" href="assets/css/asciidoctor.css">

    <div class="content"><nav class="navbar navbar-toggleable-md navbar-light" style="background-color: #EDEDED;">
    <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <a class="navbar-brand" href="#">SUSE Live Documentation (ALPHA)</a>

    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav mr-auto">
            <li class="nav-item active">
                <a class="nav-link" href="https://jcayouette.github.io/suse-publisher/index.html">Home <span class="sr-only">(current)</span></a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#">Link</a>
            </li>
            <li class="nav-item">
                <a class="nav-link disabled" href="#">Disabled</a>
            </li>
        </ul>
        <div id="navigation">
<input type="text" id="search-box" />
</div>
          <!--
        <form class="form-inline my-2 my-lg-0">
            <input class="form-control mr-sm-2" type="text" placeholder="Search" id="search-box">

            <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button> -->
        </form>
    </div>
</nav>
</div>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Arvo|Bitter|Copse|Cutive|Lora:700|Sanchez|Scope+One|Slabo+27px|Trocchi|Vesper+Libre" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Barlow" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">


</head>


<body class="landing-page">
<!-- Top most navbar -->


<!-- Page Content -->
<div class="container">
    <div class="post-header">
    <h1 class="post-title-main">Configuration Management with Salt</h1>
</div>
<div id="search-box">
  <!-- SearchBox widget will appear here -->
</div>

<div id="hits">
  <!-- Hits widget will appear here -->
</div>

<script>
  const search = instantsearch(options);

  // initialize SearchBox
  search.addWidget(
    instantsearch.widgets.searchBox({
      container: '#search-box',
      placeholder: 'Search for products'
    })
  );

  // initialize hits widget
  search.addWidget(
    instantsearch.widgets.hits({
      container: '#hits'
    })
  );

  search.start();
</script>

<!-- If this does not work place post-content back in div and remove article -->
<div class="post-content">
    <!-- HACK enough for the demo lol -->
    

    
      <a target="_blank" href="https://github.com/jcayouette/example-manager-docs/edit/master/docs/manager-docs/bp_chap_config_management_with_salt.adoc" class="btn btn-primary" role="button"> Edit me</a>
    

    <!-- page content -->
    <div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_bp.chapt.config.mgr.overview">1. Configuration Management Overview</a></li>
<li><a href="#_bp.chapt.config.mgr.level.hierarchy">2. State Data: Levels of Hierarchy</a></li>
<li><a href="#_bp.chapt.config.mgr.salt.states.storage.locations">3. Salt States Storage Locations</a></li>
<li><a href="#_bp.chapt.config.mgr.susemgr.states">4. {susemgr} States</a></li>
<li><a href="#_bp.chapt.config.mgr.pillar.data.exposed.susemgr">5. Pillar Data Exposed by {susemgr}</a></li>
</ul>
</div>
<div class="sect1">
<h2 id="_bp.chapt.config.mgr.overview">1. Configuration Management Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Salt is capable of applying states by matching minions with relevant state data.
This data comes from {susemgr}
in the form of package and custom states.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_bp.chapt.config.mgr.level.hierarchy">2. State Data: Levels of Hierarchy</h2>
<div class="sectionbody">
<div class="paragraph">
<p>State data comes from {susemgr}
in the form of package and custom states and targets minions at three specific levels of hierarchy.
The state hierarchy is defined by the following order or priority: individual minions have priority on packages and custom states over groups; next a group has priority over the organization.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Minion Level</p>
<div class="paragraph">
<p><span class="menuseq"><b class="menu">Systems</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">Specific Minion</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">States</b></span></p>
</div>
</li>
<li>
<p>Group Level</p>
<div class="paragraph">
<p><span class="menuseq"><b class="menu">Systems</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">System Groups</b></span></p>
</div>
</li>
<li>
<p>Organization Level</p>
<div class="paragraph">
<p><span class="menuseq"><b class="menu">Systems</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">Manage System Types:</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">My Organization</b></span></p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Org1 requires that vim version 1 is installed</p>
</li>
<li>
<p>Group1 requires that vim version 2 is installed</p>
</li>
<li>
<p>Group2 requires any version installed</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This would lead to the following order of hierarchy:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Minion1 part of [Org1, Group1] wants vim removed, vim is removed (Minion Level)</p>
</li>
<li>
<p>Minion2 part of [Org1, Group1] wants vim version 2 gets version 2 (Group Level)</p>
</li>
<li>
<p>Minion3 part of [Org1, Group1] wants any version, gets version 2 (Org Level)</p>
</li>
<li>
<p>Minion4 part of[Org1, Group2] wants any version, gets vim version 1 (Org Level)</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_bp.chapt.config.mgr.salt.states.storage.locations">3. Salt States Storage Locations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The {susemgr}
salt-master reads its state data from three file root locations.</p>
</div>
<div class="paragraph">
<p>The directory <code class="path">/usr/share/susemanager/salt</code>
 is used by {susemgr}
 and comes from the susemanager-sls.
It is shipped and updated together with {susemgr}
 and includes certificate setup and common state logic to be applied to packages and channels.</p>
</div>
<div class="paragraph">
<p>The directory <code class="path">/srv/susemanager/salt</code>
 is generated by {susemgr}
 and based on assigned channels and packages for minions, groups and organizations.
This file will be overwritten and regenerated.
This could be thought of as the {susemgr}
 database translated into salt directives.</p>
</div>
<div class="paragraph">
<p>The third directory <code class="path">/srv/salt</code>
 is for custom state data, modules etc. {susemgr}
 does not operate within or utilize this directory.
However the state data placed here affects the Highstate of minions and is merged with the total state result generated by {susemgr}
.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_bp.chapt.config.mgr.susemgr.states">4. {susemgr} States</h2>
<div class="sectionbody">
<div class="paragraph">
<p>All sls files created by users will be saved to disk on the salt-master server.
These files will be placed in <code class="path">/srv/susemanager/salt/</code>
 and each organization will be placed within its own directory.
Although these states are custom, these states are created using {susemgr}
.
The following provides an overview of directory structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>├── manager_org_DEVEL
│   ├── files
│   │    ... files needed by states (uploaded by users)...
│   └── state.sls
         ... other sls files (created by users)...
E.g.:
├── manager_org_TESTING
│   ├── files
│   │   └── motd     # user created
│   │    ... other files needed by states ...
│   └── motd.sls     # user created
            ... other sls files ...</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_bp.chapt.config.mgr.pillar.data.exposed.susemgr">5. Pillar Data Exposed by {susemgr}</h2>
<div class="sectionbody">
<div class="paragraph">
<p>SUSE Manager exposes a small amount of internal data like group membership, organization membership and file roots as pillars which can be used with custom sls states.
These are managed by {susemgr}
or by the user.</p>
</div>
<div class="paragraph">
<p>To avoid hard-coding organization id&#8217;s within sls files, a pillar entry is added for each organization:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>org-files-dir: relative_path_to_files</pre>
</div>
</div>
<div class="paragraph">
<p>This file will be available for all minions which belong to this organization.</p>
</div>
<div class="paragraph">
<p>The following represents a Pillar example located in <code class="path">/etc/motd</code>
:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>file.managed:
    - source: salt://{{ pillar['org-files-dir']}}/motd
    - user: root
    - group: root
    - mode: 644</pre>
</div>
</div>
</div>
</div>


</div>
<!-- Including InstantSearch.js library and styling -->
<script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.js"></script>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.css">
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch-theme-algolia.min.css">

<script>
// Instanciating InstantSearch.js with Algolia credentials
const search = instantsearch({
  appId: 'WNURXD2O78',
  indexName: 'suse-publisher',
  apiKey: '761b121f117dc5882bfa9e6b1a7abd88'
});

// Adding searchbar and results widgets
search.addWidget(
  instantsearch.widgets.searchBox({
    container: '#search-box',
    placeholder: 'Search in documents...',
    poweredBy: true // This is required if you're on the free Community plan
  })
);
search.addWidget(
  instantsearch.widgets.hits({
    container: '#search-hits'
  })
);

// Starting the search
search.start();
</script>


</div>


<!-- Footer -->

<footer class="row">

</footer>

<!-- <script src="js/vendor/jquery.js"></script>
<script src="js/foundation.min.js"></script>
<script>
    $(document).foundation();
    var doc = document.documentElement;
    doc.setAttribute('data-useragent', navigator.userAgent);
</script>-->
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js" integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ" crossorigin="anonymous"></script>
<!-- Including InstantSearch.js library and styling -->
<script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.js"></script>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.css">
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch-theme-algolia.min.css">

<script>
// Instanciating InstantSearch.js with Algolia credentials
const search = instantsearch({
  appId: 'WNURXD2O78',
  indexName: 'suse-publisher',
  apiKey: '761b121f117dc5882bfa9e6b1a7abd88'
});

// Adding searchbar and results widgets
search.addWidget(
  instantsearch.widgets.searchBox({
    container: '#search-box',
    placeholder: 'Search in documents...',
    poweredBy: true // This is required if you're on the free Community plan
  })
);
search.addWidget(
  instantsearch.widgets.hits({
    container: '#search-hits'
  })
);

// Starting the search
search.start();
</script>

</body>
</html>
