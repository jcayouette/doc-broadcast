<div class="sect1">
<h2 id="_sles.installation.within.kvm.jeos"><a class="anchor" href="#_sles.installation.within.kvm.jeos"></a>1. JeOS Installation</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_quickstart.sect.kvm.settings"><a class="anchor" href="#_quickstart.sect.kvm.settings"></a>2. Virtual Machine Manager (virt-manager) Settings</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Version Information</div>
<div class="paragraph">
<p>&susemgr;
 3.1 was originally released as a SLES 12 SP2 extension.
With the next maintenance update (2017), &susemgr;
 3.1 will be based on SLES 12 SP3 and it will support SLE 12 SP3 clients officially.
In the following sections and chapters, it is highly recommended to use SLE 12 SP3 instead of SP2.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This chapter provides the required (KVM) settings for installation of &sle;
Just Enough Operating System (JeOS) 12 as the base for &susemgr;
 3.1.
A kernel virtual machine (KVM) combined with Virtual Machine Manager (<code>virt-manager</code>) will be used as a sandbox for your first installation.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">&suse;Virtualization Guide</div>
<div class="paragraph">
<p>For more information on virtualization, see <a href="https://www.suse.com/documentation/sles-12/singlehtml/book_virt/book_virt.html" class="bare">https://www.suse.com/documentation/sles-12/singlehtml/book_virt/book_virt.html</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Enter the following settings when creating a new virtual machine using <code>virt-manager</code>.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">KVM Settings</th>
<th class="tableblock halign-left valign-top">Installation Method:</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Import Existing Disk Image</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OS:</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Linux</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Version:</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SLES12-SP2-JeOS-for-kvm-and-xen.x86_64-GM.qcow2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Memory:</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4096 MB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU&#8217;s:</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Storage Format:</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.qcow</code> 24 GB (Default) JeOS Root Partition</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Virtual Disks:</p>
<p class="tableblock">VirtIO Disk 2</p>
<p class="tableblock">VirtIO Disk 3</p>
<p class="tableblock">VirtIO Disk 4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"> </p>
<p class="tableblock">101 GB for <em class="path">/var/spacewalk</em></p>
<p class="tableblock">50 GB for <em class="path">/var/lib/pgsql</em></p>
<p class="tableblock">4 GB for swap</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name:</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>example-server</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Network</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">&suse;Virtualization Guide</div>
<div class="paragraph">
<p>For more information on virtualization, see <a href="https://www.suse.com/documentation/sles-12/singlehtml/book_virt/book_virt.html" class="bare">https://www.suse.com/documentation/sles-12/singlehtml/book_virt/book_virt.html</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="jeos_kvm_settings"><a class="anchor" href="#jeos_kvm_settings"></a>3. JeOS KVM Settings</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Create 3 additional virtual disks required for the &susemgr;
storage partitions.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure: Creating the Required Partitions with KVM</div>
<ol class="arabic">
<li>
<p>Create a new virtual machine using the downloaded JeOS KVM image and select <b class="menuref">Import existing disk image</b> .</p>
</li>
<li>
<p>Configure RAM and number of CPU&#8217;s: At least 4 GB RAM and 2 CPUs.</p>
</li>
<li>
<p>Name your KVM machine and select the <b class="menuref">&gt;Customize configuration before install</b> check box.</p>
</li>
<li>
<p>Select the <b class="menuref">Add Hardware</b> button and create three new virtual disks with the following specifications. These disks will be partitioned and mounted in the following procedure.</p>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">VirtIO Storage Disks</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Sizing</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">VirtIO Disk 2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spacewalk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">101 GB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">VirtIO Disk 3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pgsql</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">50 GB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">VirtIO Disk 4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">swap</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 GB</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Select <b class="menuref">Begin Installation</b> and your new VM will boot from the JeOS image.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Proceed through the basic JeOS installation prompts until you reach the command line.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="preparing_jeos_for"><a class="anchor" href="#preparing_jeos_for"></a>4. Preparing JeOS for &susemgr;</h2>
<div class="sectionbody">
<div class="paragraph">
<div class="title">Procedure: Preparing JeOS for &susemgr;Installation.. Register with SCC:</div>
<p>+</p>
</div>
<div class="listingblock">
<div class="content">
<pre># SUSEConnect -e EMAIL_ADDRESS -r SUSE_MANAGER_CODE</pre>
</div>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Add &susemgr; repositories:</p>
<div class="listingblock">
<div class="content">
<pre># SUSEConnect -p SUSE-Manager-Server/3.1/x86_64 -r SUSE_MANAGER_CODE</pre>
</div>
</div>
</li>
<li>
<p>Install <span class="package">patterns-openSUSE-yast2_basis</span> pattern. <em>You will need this basic administration package for preparing storage partitions</em>:</p>
<div class="listingblock">
<div class="content">
<pre># zypper in pattern -t patterns-openSUSE-yast2_basis</pre>
</div>
</div>
</li>
<li>
<p>Partition and mount the virtual disks at the following locations using &yast; Partitioner (<code>yast2 disk</code>).</p>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">VirtIO Storage Disks</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Storage Size</th>
<th class="tableblock halign-left valign-top">File System Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">VirtIO Disk 2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em class="path">/var/spacewalk</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">101 GB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">XFS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">VirtIO Disk 3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em class="path">/var/lib/pgsql</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">50 GB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">XFS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">VirtIO Disk 4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em class="path">/swap</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 GB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">swap</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>SLES 12 by default uses the BTRFS file system. A mount point is created automatically for <em class="path">/var/lib/pgsql/</em> (even when not installed). This must be removed or commented out from the <em class="path">/etc/fstab</em> entries. As &rootuser; edit <em class="path">/etc/fstab</em> and comment out or remove the line:</p>
<div class="listingblock">
<div class="content">
<pre>/var/lib/pgsql btrfs subvol=@/var/lib/pgsql 0 0</pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title">Removing the /etc/fstab pgsql Entry</div>
<div class="paragraph">
<p>If you do not remove this line from fstab the first time you shutdown the server you will lose your database.
This occurs because you will have duplicate entries in the fstab.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Exit partitioner and install the &susemgr; pattern:</p>
<div class="listingblock">
<div class="content">
<pre># zypper in -t pattern suma_server</pre>
</div>
</div>
</li>
<li>
<p>Execute &susemgr; setup:</p>
<div class="listingblock">
<div class="content">
<pre># yast2 susemanager_setup</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Proceed to <a href="#_suma.setup.with.yast">[_suma.setup.with.yast]</a>
.</p>
</div>
</div>
</div>